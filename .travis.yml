language: python

python:
 - "2.7"

virtualenv:
 system_site_packages: true

before_install:
 # Need my version of PyGithub at the moment so that we can provide context to statuses
 - pip install https://github.com/andycasey/PyGithub/archive/master.zip
 - python status.py
 
 # OK now install the stuff we need
 - sudo apt-get install gfortran libcfitsio3-dev python-matplotlib python-pyfits python-scipy
 - "export DISPLAY=:99.0"
 - "sh -e /etc/init.d/xvfb start"
 - pip install coveralls

install:
 - pip install -r requirements.txt --use-mirrors
 - python setup.py build_ext --inplace

script:
 - nosetests --with-coverage --cover-package=oracle

after_success:
 - coveralls
 - 'echo "TRAVIS_PULL_REQUEST=$TRAVIS_PULL_REQUEST";'
 - 'echo "TRAVIS_JOB_NUMBER=$TRAVIS_JOB_NUMBER";'
 - 'echo "TRAVIS_COMMIT=$TRAVIS_COMMIT";'
 - 'echo "LATEST_COMMIT_HASH=$LATEST_COMMIT_HASH";'
 - 'echo "CURRENT_COMMIT_HASH=$CURRENT_COMMIT_HASH";'
 - "if [[ $TRAVIS_PULL_REQUEST != 'false' ]]; then python science.py; fi"

after_script:
 - python status.py 

notifications:
 email:
  - andycasey@gmail.com
